PROGRAM SLUV

! Program to calculate the scattering length per unit volume from amino acid and carbohydrate composition
! of a protein/glycoprotein
! 
! Requires a file containg the occurence frequency of each amino acid (in the order they appear in the variable AN) 
! This file is read from stdin

! [SJP1] Perkins, S. J. (1986). Protein volumes and hydration effects: The calculations of partial specific volumes, neutron scattering matchpoints
! and 280-nm absorption coefficients for proteins and glycoproteins from amino acid sequences. Eur. J. Biochem. 157, 169-180 
!
! [SJP2] Perkins, S. J. (2001). X-ray and neutron scattering analyses of hydration shells: 
! a molecular interpretation based on sequence predictions and model fits. Biophysical Chemistry 93, 129â€“139


! First (Fortran 77) version written 19/5/1979 by Stephen J. Perkins (SJP)
! Modified and much rewritten 9/8/1982 by SJP
! Rewritten again 20/6/1986 to 6/7/1985 by SJP
! C&E 43 Volumes and Wetlaufer TRP ext 25/11/1985
! Corrected for amino acid and carbohydrate scattering lengths 23/1/1986 by SJP
! Rewritten to compile on SGI server 23/4/1991 by K.F. SMITH
! Painfully converted into something a little more maintainable (Fortran 90) by David W. Wright starting 14/10/2013
! TODO: Edit to reduce c&p'd code use

INTEGER NTITL1(20)
DIMENSION AVS(27), AVR(27), AVZ84(27), AVCE(27)
DIMENSION IAC(27), ELEC(27), AVC(27), AVZ72(27), AVP(27)
DIMENSION BH(27), BD(27) 
DIMENSION NOEX(27), NOPEEX(27)
DIMENSION BHT(27), BDT(27), WT(27)

CHARACTER AN(27)*3
REAL BHHO, BDDO, EHHO
REAL WEIGHT, BDTOT, BHTOT, ELTOT
REAL VOLC, VOLP, VOLZ, VOLZZ, VOLCC, VOLR, VOLS
REAL SVC, SVP, SVZ, SVZZ, SVCC, SVR, SVS
REAL ELC, ELZ, ELP, ELCC, ELZZ, ELR, ELS
REAL SDHC, SDDC, SDHP, SDDP, SDHZ, SDDZ
REAL SDHZZ, SDDZZ, SDHCC, SDDCC
REAL SDHR, SDDR, SDHS, SDDS
REAL ATPTC, ATPTP, ATPTZ, ATPTZZ, ATPTCC, ATPTR, ATPTS
REAL SCC, SCP, SCZ, SCZZ, SCCC, SCR, SCS
REAL AVAGADRO
REAL BOH, BOD, VOLDIF, DIFOH, VOLOH, VL

COMMON AVS, AVR, AVZ84, AVCE, ELEC, AVC, AVZ72, AVP, BH, BD, WT

! IF IARGC() .LT. 2 THEN
!    WRITE(*,*) "Error: An input file must be provided!" 
!    STOP
! END IF

! AN is a list of all amino acid/carbohydrate names
! the order used here is used for the other data arrays below
DATA AN/"ILE","PHE","VAL","LEU","TRP","MET","ALA","GLY", &
    "CYS","TYR","PRO","THR","SER","HIS","GLU","ASN", &
    "GLN","ASP","LYS","ARG","GLC","GAL","MAN","GLN", &
    "GAN","FUC","NEU"/

! The following arrays contain the amino acid residue volumes taken from the listed sources
! Units = 10^{-3} nm^3

! Cohn, E. J. & Edsall, J. T. (1943) in Proteins, amino acids and
! peptides, pp. 155-176 & 370-381, Reinhold Publ. Corp., New York.
DATA AVCE/168.9,187.9,141.4,168.9,228.5,163.1,87.2,60.6, &
    106.7,192.1,122.4,117.4,91.0,152.4,141.4,117.4, &
    142.4,114.6,174.3,181.3,164.9,164.9,164.9,224.5, &
    224.5,164.3,281.2/
  
! Densitrometry
! Zamyatnin, A. A. (1972) Progr. Biophys. Mol. Biol. 24, 109-123.
DATA  AVZ72/166.1,189.2,139.4,166.1,226.9,162.3,88.3,59.9, &
    108.1,192.9,122.2,115.7,88.6,152.5,137.8,117.3, & 
    143.3,110.6,167.9,172.7,162.7,162.2,161.9,216.6, &
    227.5,155.4,320.9/

! Densitrometry
! Zamyatnin, A. A. (1984) Annu. Rev. Biophys. Bioeng. 13, 145-165.    
DATA AVZ84/164.6,187.2,136.8,164.6,225.1,161.0,86.4,57.8, &
    107.9,190.5,120.6,113.5,86.2,150.1,128.7,115.6, & 
    141.9,108.5,166.2,197.3,162.7,162.2,161.9,216.6, &
    227.5,155.4,320.9/

! Protein Crystal Structures
! Chothia, C. (1975) Nature (Lond.) 254, 304-308.
DATA AVC/168.8,203.4,141.7,167.9,237.6,170.8,91.5,66.4, &
    105.6,203.6,129.3,122.1,99.1,167.3,155.1,135.2, &
    161.1,124.5,171.3,202.1,171.9,166.8,170.8,222.0, &
    232.9,160.8,326.3/

! Amino acid crystal structures [SJP1]
DATA AVP/170.1,203.9,142.3,182.8,228.9,176.0,97.1,68.2, &
    112.4,202.3,129.0,129.0,103.3,158.3,148.0,127.4, &
    147.3,125.3,184.5,192.9,171.9,166.8,170.8,222.0, &
    232.9,160.8,326.3/

! Molar group summations (method B)
! Chothia, C. & Janin, J. (1975) Nature (Lond.) 256, 705-708.
DATA AVR/173.8,182.5,147.3,173.8,236.6,173.7,92.1,62.5, &
    107.9,181.5,132.3,127.9,97.8,172.9,150.3,123.8, &
    150.3,123.8,187.8,198.8,167.3,167.3,163.3,230.4, &
    230.4,160.8,326.3/

! Consensus volume from the above 6 datasets [SJP 1]
DATA AVS/166.1,189.7,138.8,168.0,227.9,165.2,87.8,59.9, &
    105.4,191.2,123.3,118.3,91.7,156.3,140.9,120.1, &
    145.1,115.4,172.7,188.2,171.9,166.8,170.8,222.0, &
    232.9,160.8,326.3/
    
! Amino acid/carboydrate scattering lengths ( (H)ydrogen and (D)ueterium)

! Values direct from:
! Jacrot, B. (1976) Rep. Progr. Phys. 39,911 -953.
!
!     DATA BH/1.396,4.139,1.479,1.396,6.035,1.764,1.645,1.728,
!    1 1.930,4.719,2.227,2.142,2.225,4.959,3.762,3.456,3.373,
!    2 3.845,1.586,3.466,3.151,3.151,3.151,4.298,4.298,2.570,
!    3 6.912/
!     DATA BD/2.437,5.180,2.520,2.437,8.118,2.805,2.686,2.769,
!    1 4.013,6.802,2.227,4.224,4.308,6.521,4.803,6.580,6.497,
!    2 4.886,5.752,9.714,6.275,6.275,6.275,7.422,7.422,5.694,
!    3 12.119/

! Values 'corrected' by SJP
DATA BH/1.3948,4.1385,1.4781,1.3948,6.0345,1.7628,1.6447,1.7280, &
    2.3036,4.7189,2.2265,2.1418,2.2251,4.3974,3.7615,3.4560, &
    3.3727,3.8448,1.5864,3.4664,3.1506,3.1506,3.1506,4.2982, &
    4.2982,2.5702,6.9121/
    
DATA BD/2.4361,5.1798,2.5194,2.4381,8.1171,2.8041,2.6860,2.7693, &
    3.3449,6.8015,2.2265,4.2244,4.3077,7.5213,4.8028,6.5799, &
    6.4966,4.8861,5.7516,9.7142,6.2745,6.2745,6.2745,7.4221, &
    7.4221,5.6941,12.1186/
    
! Number of exchangable hydrogens
DATA NOEX/1,1,1,1,2,1,1,1, &
    1,2,0,2,2,3,1,3, &
    3,1,4,6,3,3,3,3, &
    3,3,5/
! Number of exchangable peptide hydrogens
DATA NOPEEX/1,1,1,1,1,1,1,1, &
    1,1,0,1,1,1,1,1, &
    1,1,1,1,0,0,0,0, &
    0,0,0/
    
! Residue/sugar masses
DATA WT/113.0,147.0,99.0,113.0,186.0,131.0,71.0,57.0, &
    102.0,163.0,97.0,101.0,87.0,137.0,129.0,114.0, &
    128.0,115.0,128.0,156.0,162.0,162.0,162.0,203.0, &
    203.0,146.0,290.0/
    
! Number of electrons per residue/sugar
DATA ELEC/62.0,78.0,54.0,62.0,98.0,70.0,38.0,30.0, &
    53.0,86.0,52.0,54.0,46.0,73.0,67.0,60.0, &
    68.0,63.0,71.0,85.0,86.0,86.0,86.0,108.0, &
    108.0,78.0,153.0/

! Calculate scattering densities for H20 and D2O
! Sum of scattering lengths divided by the free water volume
BHHO=-0.168/29.9
BDDO=1.9146/29.9
! Calculate the electron density of water
EHHO = 10.0/29.9

! Avagadro's no * (10^-8)^3
! The factor at the end is use to convert units from angstrom^3 to millilitres
AVAGADRO = 0.6023

! Unit 5 is stdin
! Read first line of the input file, which is a title.   
READ(5,'(20A2)')(NTITL1(J),J=1,20)

! Read in the residue frequencies from the input file
DO I=1,27
      READ(5,'(I3)') IAC(I)
END DO

WRITE (6,'(A,20A2)') " TITLE ", NTITL1
WRITE (6,'(A)') " SLUV VERSION OCTOBER 2013 :  S. J. Perkins & D. W. Wright"
WRITE(6,'(1X)')
WRITE(6,'(A,1X)') " RESID  TOT C&E43 ZAM72 ZAM84 RIC74 CHO75 PER85 CON85   MWT ELEC B(H2O) B(D2O)"
WRITE(6,'(1X)')
DO I=1,27 
    IF(I.EQ.12) WRITE(6,'(1X)')
    IF(I.EQ.21) THEN
        WRITE(6,'(1X)')
        WRITE(6,'(A)') "            GIB72 SHA76 SHA76 PER81 PER85 PER85 PER85"
        WRITE(6,'(1X)')
    END IF
    WRITE(6,'(3X,A3,I5,7F6.1,2X,2F5.0,F6.3,F7.3)') AN(I), IAC(I), AVCE(I), AVZ72(I), AVZ84(I), AVR(I), AVC(I), &
        AVP(I), AVS(I), WT(I), ELEC(I), BH(I), BD(I)      
END DO

!
! Summation of all properties for whole glycoprotein
!
CALL SUM_PROPERTIES( 1, 27, IAC, WEIGHT, BDTOT, BHTOT, ELTOT, VOLC, VOLP, VOLZ, VOLZZ, VOLCC, VOLR, VOLS, ISUMC)
! Print Total number of residues
WRITE(6,'(1X)')
WRITE(6,'(1X,A,I4)') "TOTAL ", ISUMC
WRITE(6,'(1X)')

! Store total weight so that we can work out what fraction of the whole is protein etc. later on
TOTWT=WEIGHT

! Calculate densities and specific volumes 

BHM = BHTOT/WEIGHT
BDM = BDTOT/WEIGHT
      
SVC = VOLC * AVAGADRO/WEIGHT
SVP = VOLP * AVAGADRO/WEIGHT
SVZ = VOLZ * AVAGADRO/WEIGHT
SVZZ = VOLZZ * AVAGADRO/WEIGHT
SVCC = VOLCC * AVAGADRO/WEIGHT
SVR= VOLR * AVAGADRO/WEIGHT
SVS= VOLS * AVAGADRO/WEIGHT
      
ELC = ELTOT/VOLC
ELZ = ELTOT/VOLZ
ELP = ELTOT/VOLP
ELCC = ELTOT/VOLCC
ELZZ = ELTOT/VOLZZ
ELR = ELTOT/VOLR
ELS = ELTOT/VOLS
      
SDHC = BHTOT/VOLC
SDDC = BDTOT/VOLC
SDHP = BHTOT/VOLP
SDDP = BDTOT/VOLP
SDHZ = BHTOT/VOLZ
SDDZ = BDTOT/VOLZ
SDHZZ = BHTOT/VOLZZ
SDDZZ = BDTOT/VOLZZ
SDHCC = BHTOT/VOLCC
SDDCC = BDTOT/VOLCC
SDHR = BHTOT/VOLR
SDDR = BDTOT/VOLR
SDHS = BHTOT/VOLS
SDDS = BDTOT/VOLS

! Calculate Matchpoints
      
ATPTC = ((SDHC-BHHO)*100.0)/(BDDO-BHHO-SDDC+SDHC)
ATPTP = ((SDHP-BHHO)*100.0)/(BDDO-BHHO-SDDP+SDHP)
ATPTZ = ((SDHZ-BHHO)*100.0)/(BDDO-BHHO-SDDZ+SDHZ)
ATPTZZ= ((SDHZZ-BHHO)*100.0)/(BDDO-BHHO-SDDZZ+SDHZZ)
ATPTCC= ((SDHCC-BHHO)*100.0)/(BDDO-BHHO-SDDCC+SDHCC)
ATPTR = ((SDHR-BHHO)*100.0)/(BDDO-BHHO-SDDR+SDHR)
ATPTS = ((SDHS-BHHO)*100.0)/(BDDO-BHHO-SDDS+SDHS)
SCC = (ATPTC*(BDDO-BHHO)/100.0) + BHHO
SCP = (ATPTP*(BDDO-BHHO)/100.0) + BHHO
SCZ = (ATPTZ*(BDDO-BHHO)/100.0) + BHHO
SCZZ= (ATPTZZ*(BDDO-BHHO)/100.0) + BHHO
SCCC= (ATPTCC*(BDDO-BHHO)/100.0) + BHHO
SCR = (ATPTR*(BDDO-BHHO)/100.0) + BHHO
SCS = (ATPTS*(BDDO-BHHO)/100.0) + BHHO
      
EXTINC = (10.0 * ( IAC(9) * 150.0 + IAC(10) * 1340.0 + IAC(5) * 5550.0) ) / WEIGHT
EXTINCC = EXTINC * 1.06
EXTIN = EXTINC * 1.03

WRITE(6,'(A)') " ************* TOTAL GLYCOPROTEIN ********************************************"
WRITE (6,'(A,F10.0)') " MOLECULAR WEIGHT           ", WEIGHT
WRITE (6,'(A,F6.3)') " EXTINCTION COEFF (280 NM)      ", EXTINC
WRITE(6,'(A,F6.3)') " EXT COEFF X FACTOR OF 1.03     ", EXTIN
WRITE(6,'(A,F6.3)') " EXT COEFF X FACTOR OF 1.06     ", EXTINCC
WRITE (6,'(A,F10.2,4X,F10.2)') " TOTAL B      IN H2O & D2O  ", BHTOT, BDTOT
WRITE (6,'(A,F10.7,4X,F10.7)') " TOTAL B ON M IN H2O & D2O  ", BHM,BDM
WRITE (6,'(A,F10.7,A,F10.7,A)') " SCATT DENSITIES OF WATER   ", BHHO, " H2O", BDDO, " D2O "
WRITE(6,'(A,F10.0)') " TOTAL ELECTRONS            ", ELTOT
WRITE(6,'(A,F10.5)') " ELECT DENSITY  OF WATER    ", EHHO
WRITE(6,'(17X,A)') "   C&E 43  ZAM 72  ZAM 84  RIC 74  CHO 75  PER 85  CON 85"
WRITE(6,'(A,7F8.0)') " VOLUME           ", VOLCC, VOLZ, VOLZZ, VOLR, VOLC, VOLP, VOLS
WRITE(6,'(A,7F8.4)') " SPECIFIC VOLUMES ", SVCC, SVZ, SVZZ, SVR, SVC, SVP, SVS
WRITE(6,'(A,7F8.2)') " MATCHPOINTS      ", ATPTCC, ATPTZ, ATPTZZ, ATPTR, ATPTC, ATPTP, ATPTS
WRITE(6,'(A,7F8.5)') " SCATT DEN AT MTPT", SCCC, SCZ, SCZZ, SCR, SCC, SCP, SCS
WRITE(6,'(A,7F8.5)') " ELECT DEN        ", ELCC, ELZ, ELZZ, ELR, ELC, ELP, ELS

!
! Consider hydration by OH groups
!

! OH/OD scattering lengths
BOH=0.2062
BOD=1.2475

VOLDIF = VOLC - VOLS
DIFOH = VOLDIF / 5.4
! Bound water volume is 24.5
VOLOH=24.5
      
BHTOT = BHTOT + ( BOH * DIFOH ) 
BDTOT = BDTOT + ( BOD * DIFOH )
 
VL = VOLOH*DIFOH

VOLC = VOLC + VL
VOLP = VOLP + VL
VOLZ = VOLZ + VL
VOLZZ=VOLZZ + VL
VOLCC=VOLCC + VL
VOLR = VOLR + VL
VOLS = VOLS + VL

ISUMC = 0
DO I=1,20 
    ISUMC = ISUMC + IAC(I)
END DO
DIFRES = DIFOH/ISUMC

SDHC = BHTOT/VOLC
SDDC = BDTOT/VOLC
SDHP = BHTOT/VOLP
SDDP = BDTOT/VOLP
SDHZ = BHTOT/VOLZ
SDDZ = BDTOT/VOLZ
SDHZZ= BHTOT/VOLZZ
SDDZZ= BDTOT/VOLZZ
SDHCC= BHTOT/VOLCC
SDDCC= BDTOT/VOLCC
SDHR = BHTOT/VOLR
SDDR = BDTOT/VOLR
SDHS = BHTOT/VOLS
SDDS = BDTOT/VOLS

ATPTC = ((SDHC-BHHO)*100.0)/(BDDO-BHHO-SDDC+SDHC)
ATPTP = ((SDHP-BHHO)*100.0)/(BDDO-BHHO-SDDP+SDHP)
ATPTZ = ((SDHZ-BHHO)*100.0)/(BDDO-BHHO-SDDZ+SDHZ)
ATPTZZ= ((SDHZZ-BHHO)*100.0)/(BDDO-BHHO-SDDZZ+SDHZZ)
ATPTCC= ((SDHCC-BHHO)*100.0)/(BDDO-BHHO-SDDCC+SDHCC)
ATPTR = ((SDHR-BHHO)*100.0)/(BDDO-BHHO-SDDR+SDHR)
ATPTS = ((SDHS-BHHO)*100.0)/(BDDO-BHHO-SDDS+SDHS)

WRITE(6,*) " ************* HYDRATION OF TOTAL GLYCOPROTEIN BY OH GROUPS ******************"
WRITE(6,'(A,F10.0,A,F10.0)') " DIFF (CHO75 - CON85) VOLS = ", VOLDIF, " TOTAL OF EQUIV BOUND H2O  = ", DIFOH 
WRITE(6,'(A,F10.2)') " AVERAGE H2O PER AA RESIDUE= ", DIFRES
WRITE (6,'(A,F10.2,4X,F10.2)') " TOTAL B      IN H2O & D2O  ", BHTOT, BDTOT
WRITE(6,'(17X,A)') "   C&E 43  ZAM 72  ZAM 84  RIC 74  CHO 75  PER 85  CON 85"
WRITE(6,'(A,7F8.0)') " VOLUME           ", VOLCC, VOLZ, VOLZZ, VOLR, VOLC, VOLP, VOLS
WRITE(6,'(A,7F8.2)') " MATCHPOINTS      ", ATPTCC, ATPTZ, ATPTZZ, ATPTR, ATPTC, ATPTP, ATPTS

!
! Calculations for protein residues alone
!

CALL SUM_PROPERTIES( 1, 20, IAC, WEIGHT, BDTOT, BHTOT, ELTOT, VOLC, VOLP, VOLZ, VOLZZ, VOLCC, VOLR, VOLS, ISUMC)

FRWT=(WEIGHT*100.0)/TOTWT

! Calculate densities and specific volumes 

BHM = BHTOT/WEIGHT
BDM = BDTOT/WEIGHT
      
SVC = VOLC * AVAGADRO/WEIGHT
SVP = VOLP * AVAGADRO/WEIGHT
SVZ = VOLZ * AVAGADRO/WEIGHT
SVZZ = VOLZZ * AVAGADRO/WEIGHT
SVCC = VOLCC * AVAGADRO/WEIGHT
SVR= VOLR * AVAGADRO/WEIGHT
SVS= VOLS * AVAGADRO/WEIGHT
      
ELC = ELTOT/VOLC
ELZ = ELTOT/VOLZ
ELP = ELTOT/VOLP
ELCC = ELTOT/VOLCC
ELZZ = ELTOT/VOLZZ
ELR = ELTOT/VOLR
ELS = ELTOT/VOLS
      
SDHC = BHTOT/VOLC
SDDC = BDTOT/VOLC
SDHP = BHTOT/VOLP
SDDP = BDTOT/VOLP
SDHZ = BHTOT/VOLZ
SDDZ = BDTOT/VOLZ
SDHZZ = BHTOT/VOLZZ
SDDZZ = BDTOT/VOLZZ
SDHCC = BHTOT/VOLCC
SDDCC = BDTOT/VOLCC
SDHR = BHTOT/VOLR
SDDR = BDTOT/VOLR
SDHS = BHTOT/VOLS
SDDS = BDTOT/VOLS

! Calculate Matchpoints
      
ATPTC = ((SDHC-BHHO)*100.0)/(BDDO-BHHO-SDDC+SDHC)
ATPTP = ((SDHP-BHHO)*100.0)/(BDDO-BHHO-SDDP+SDHP)
ATPTZ = ((SDHZ-BHHO)*100.0)/(BDDO-BHHO-SDDZ+SDHZ)
ATPTZZ= ((SDHZZ-BHHO)*100.0)/(BDDO-BHHO-SDDZZ+SDHZZ)
ATPTCC= ((SDHCC-BHHO)*100.0)/(BDDO-BHHO-SDDCC+SDHCC)
ATPTR = ((SDHR-BHHO)*100.0)/(BDDO-BHHO-SDDR+SDHR)
ATPTS = ((SDHS-BHHO)*100.0)/(BDDO-BHHO-SDDS+SDHS)
SCC = (ATPTC*(BDDO-BHHO)/100.0) + BHHO
SCP = (ATPTP*(BDDO-BHHO)/100.0) + BHHO
SCZ = (ATPTZ*(BDDO-BHHO)/100.0) + BHHO
SCZZ= (ATPTZZ*(BDDO-BHHO)/100.0) + BHHO
SCCC= (ATPTCC*(BDDO-BHHO)/100.0) + BHHO
SCR = (ATPTR*(BDDO-BHHO)/100.0) + BHHO
SCS = (ATPTS*(BDDO-BHHO)/100.0) + BHHO

WRITE(6,*) " ************* PROTEIN RESIDUES ONLY *****************************************"
WRITE (6,'(A,F10.0,A,F5.1,A,I5)') " MOLECULAR WEIGHT           ", WEIGHT, "       % MASS ", FRWT,"       RESIDUES ", ISUMC

WRITE (6,'(A,F10.2,4X,F10.2)') " TOTAL B      IN H2O & D2O  ", BHTOT, BDTOT
WRITE (6,'(A,F10.7,4X,F10.7)') " TOTAL B ON M IN H2O & D2O  ", BHM,BDM
WRITE (6,'(A,F10.7,A,F10.7,A)') " SCATT DENSITIES OF WATER   ", BHHO, " H2O", BDDO, " D2O "
WRITE (6,'(A,F10.0)') " TOTAL ELECTRONS            ", ELTOT
WRITE (6,'(A,F10.5)') " ELECT DENSITY  OF WATER    ", EHHO
WRITE (6,'(17X,A)') "   C&E 43  ZAM 72  ZAM 84  RIC 74  CHO 75  PER 85  CON 85"
WRITE (6,'(A,7F8.0)') " VOLUME           ", VOLCC, VOLZ, VOLZZ, VOLR, VOLC, VOLP, VOLS
WRITE (6,'(A,7F8.4)') " SPECIFIC VOLUMES ", SVCC, SVZ, SVZZ, SVR, SVC, SVP, SVS
WRITE (6,'(A,7F8.2)') " MATCHPOINTS      ", ATPTCC, ATPTZ, ATPTZZ, ATPTR, ATPTC, ATPTP, ATPTS
WRITE (6,'(A,7F8.5)') " SCATT DEN AT MTPT", SCCC, SCZ, SCZZ, SCR, SCC, SCP, SCS
WRITE (6,'(A,7F8.5)') " ELECT DEN        ", ELCC, ELZ, ELZZ, ELR, ELC, ELP, ELS

! Summation for non-polar amino acid residues only
CALL SUM_PROPERTIES( 1, 11, IAC, WEIGHT, BDTOT, BHTOT, ELTOT, VOLC, VOLP, VOLZ, VOLZZ, VOLCC, VOLR, VOLS, ISUMC)
FRWT=(WEIGHT*100.0)/TOTWT

! Calculate densities and specific volumes 

BHM = BHTOT/WEIGHT
BDM = BDTOT/WEIGHT
      
SVC = VOLC * AVAGADRO/WEIGHT
SVP = VOLP * AVAGADRO/WEIGHT
SVZ = VOLZ * AVAGADRO/WEIGHT
SVZZ = VOLZZ * AVAGADRO/WEIGHT
SVCC = VOLCC * AVAGADRO/WEIGHT
SVR= VOLR * AVAGADRO/WEIGHT
SVS= VOLS * AVAGADRO/WEIGHT
      
ELC = ELTOT/VOLC
ELZ = ELTOT/VOLZ
ELP = ELTOT/VOLP
ELCC = ELTOT/VOLCC
ELZZ = ELTOT/VOLZZ
ELR = ELTOT/VOLR
ELS = ELTOT/VOLS
      
SDHC = BHTOT/VOLC
SDDC = BDTOT/VOLC
SDHP = BHTOT/VOLP
SDDP = BDTOT/VOLP
SDHZ = BHTOT/VOLZ
SDDZ = BDTOT/VOLZ
SDHZZ = BHTOT/VOLZZ
SDDZZ = BDTOT/VOLZZ
SDHCC = BHTOT/VOLCC
SDDCC = BDTOT/VOLCC
SDHR = BHTOT/VOLR
SDDR = BDTOT/VOLR
SDHS = BHTOT/VOLS
SDDS = BDTOT/VOLS

! Calculate Matchpoints
      
ATPTC = ((SDHC-BHHO)*100.0)/(BDDO-BHHO-SDDC+SDHC)
ATPTP = ((SDHP-BHHO)*100.0)/(BDDO-BHHO-SDDP+SDHP)
ATPTZ = ((SDHZ-BHHO)*100.0)/(BDDO-BHHO-SDDZ+SDHZ)
ATPTZZ= ((SDHZZ-BHHO)*100.0)/(BDDO-BHHO-SDDZZ+SDHZZ)
ATPTCC= ((SDHCC-BHHO)*100.0)/(BDDO-BHHO-SDDCC+SDHCC)
ATPTR = ((SDHR-BHHO)*100.0)/(BDDO-BHHO-SDDR+SDHR)
ATPTS = ((SDHS-BHHO)*100.0)/(BDDO-BHHO-SDDS+SDHS)
SCC = (ATPTC*(BDDO-BHHO)/100.0) + BHHO
SCP = (ATPTP*(BDDO-BHHO)/100.0) + BHHO
SCZ = (ATPTZ*(BDDO-BHHO)/100.0) + BHHO
SCZZ= (ATPTZZ*(BDDO-BHHO)/100.0) + BHHO
SCCC= (ATPTCC*(BDDO-BHHO)/100.0) + BHHO
SCR = (ATPTR*(BDDO-BHHO)/100.0) + BHHO
SCS = (ATPTS*(BDDO-BHHO)/100.0) + BHHO

WRITE(6,*) " ************* NONPOLAR AA RESIDUES ******************************************"
WRITE (6,'(A,F10.0,A,F5.1,A,I5)') " MOLECULAR WEIGHT           ", WEIGHT, "       % MASS ", FRWT,"       RESIDUES ", ISUMC

WRITE (6,'(A,F10.2,4X,F10.2)') " TOTAL B      IN H2O & D2O  ", BHTOT, BDTOT
WRITE (6,'(A,F10.7,4X,F10.7)') " TOTAL B ON M IN H2O & D2O  ", BHM,BDM
WRITE (6,'(A,F10.7,A,F10.7,A)') " SCATT DENSITIES OF WATER   ", BHHO, " H2O", BDDO, " D2O "
WRITE (6,'(A,F10.0)') " TOTAL ELECTRONS            ", ELTOT
WRITE (6,'(A,F10.5)') " ELECT DENSITY  OF WATER    ", EHHO
WRITE (6,'(17X,A)') "   C&E 43  ZAM 72  ZAM 84  RIC 74  CHO 75  PER 85  CON 85"
WRITE (6,'(A,7F8.0)') " VOLUME           ", VOLCC, VOLZ, VOLZZ, VOLR, VOLC, VOLP, VOLS
WRITE (6,'(A,7F8.4)') " SPECIFIC VOLUMES ", SVCC, SVZ, SVZZ, SVR, SVC, SVP, SVS
WRITE (6,'(A,7F8.2)') " MATCHPOINTS      ", ATPTCC, ATPTZ, ATPTZZ, ATPTR, ATPTC, ATPTP, ATPTS
WRITE (6,'(A,7F8.5)') " SCATT DEN AT MTPT", SCCC, SCZ, SCZZ, SCR, SCC, SCP, SCS
WRITE (6,'(A,7F8.5)') " ELECT DEN        ", ELCC, ELZ, ELZZ, ELR, ELC, ELP, ELS

! Summation for polar residues only

CALL SUM_PROPERTIES( 12, 20, IAC, WEIGHT, BDTOT, BHTOT, ELTOT, VOLC, VOLP, VOLZ, VOLZZ, VOLCC, VOLR, VOLS, ISUMC)

FRWT=(WEIGHT*100.0)/TOTWT

! Calculate densities and specific volumes 

BHM = BHTOT/WEIGHT
BDM = BDTOT/WEIGHT
      
SVC = VOLC * AVAGADRO/WEIGHT
SVP = VOLP * AVAGADRO/WEIGHT
SVZ = VOLZ * AVAGADRO/WEIGHT
SVZZ = VOLZZ * AVAGADRO/WEIGHT
SVCC = VOLCC * AVAGADRO/WEIGHT
SVR = VOLR * AVAGADRO/WEIGHT
SVS = VOLS * AVAGADRO/WEIGHT
      
ELC = ELTOT/VOLC
ELZ = ELTOT/VOLZ
ELP = ELTOT/VOLP
ELCC = ELTOT/VOLCC
ELZZ = ELTOT/VOLZZ
ELR = ELTOT/VOLR
ELS = ELTOT/VOLS
      
SDHC = BHTOT/VOLC
SDDC = BDTOT/VOLC
SDHP = BHTOT/VOLP
SDDP = BDTOT/VOLP
SDHZ = BHTOT/VOLZ
SDDZ = BDTOT/VOLZ
SDHZZ = BHTOT/VOLZZ
SDDZZ = BDTOT/VOLZZ
SDHCC = BHTOT/VOLCC
SDDCC = BDTOT/VOLCC
SDHR = BHTOT/VOLR
SDDR = BDTOT/VOLR
SDHS = BHTOT/VOLS
SDDS = BDTOT/VOLS

! Calculate Matchpoints
     
ATPTC = ((SDHC-BHHO)*100.0)/(BDDO-BHHO-SDDC+SDHC)
ATPTP = ((SDHP-BHHO)*100.0)/(BDDO-BHHO-SDDP+SDHP)
ATPTZ = ((SDHZ-BHHO)*100.0)/(BDDO-BHHO-SDDZ+SDHZ)
ATPTZZ= ((SDHZZ-BHHO)*100.0)/(BDDO-BHHO-SDDZZ+SDHZZ)
ATPTCC= ((SDHCC-BHHO)*100.0)/(BDDO-BHHO-SDDCC+SDHCC)
ATPTR = ((SDHR-BHHO)*100.0)/(BDDO-BHHO-SDDR+SDHR)
ATPTS = ((SDHS-BHHO)*100.0)/(BDDO-BHHO-SDDS+SDHS)
SCC = (ATPTC*(BDDO-BHHO)/100.0) + BHHO
SCP = (ATPTP*(BDDO-BHHO)/100.0) + BHHO
SCZ = (ATPTZ*(BDDO-BHHO)/100.0) + BHHO
SCZZ= (ATPTZZ*(BDDO-BHHO)/100.0) + BHHO
SCCC= (ATPTCC*(BDDO-BHHO)/100.0) + BHHO
SCR = (ATPTR*(BDDO-BHHO)/100.0) + BHHO
SCS = (ATPTS*(BDDO-BHHO)/100.0) + BHHO

WRITE(6,*) " ************* POLAR AA RESIDUES *********************************************"
WRITE (6,'(A,F10.0,A,F5.1,A,I5)') " MOLECULAR WEIGHT           ", WEIGHT, "       % MASS ", FRWT,"       RESIDUES ", ISUMC

WRITE (6,'(A,F10.2,4X,F10.2)') " TOTAL B      IN H2O & D2O  ", BHTOT, BDTOT
WRITE (6,'(A,F10.7,4X,F10.7)') " TOTAL B ON M IN H2O & D2O  ", BHM,BDM
WRITE (6,'(A,F10.7,A,F10.7,A)') " SCATT DENSITIES OF WATER   ", BHHO, " H2O", BDDO, " D2O "
WRITE (6,'(A,F10.0)') " TOTAL ELECTRONS            ", ELTOT
WRITE (6,'(A,F10.5)') " ELECT DENSITY  OF WATER    ", EHHO
WRITE (6,'(17X,A)') "   C&E 43  ZAM 72  ZAM 84  RIC 74  CHO 75  PER 85  CON 85"
WRITE (6,'(A,7F8.0)') " VOLUME           ", VOLCC, VOLZ, VOLZZ, VOLR, VOLC, VOLP, VOLS
WRITE (6,'(A,7F8.4)') " SPECIFIC VOLUMES ", SVCC, SVZ, SVZZ, SVR, SVC, SVP, SVS
WRITE (6,'(A,7F8.2)') " MATCHPOINTS      ", ATPTCC, ATPTZ, ATPTZZ, ATPTR, ATPTC, ATPTP, ATPTS
WRITE (6,'(A,7F8.5)') " SCATT DEN AT MTPT", SCCC, SCZ, SCZZ, SCR, SCC, SCP, SCS
WRITE (6,'(A,7F8.5)') " ELECT DEN        ", ELCC, ELZ, ELZZ, ELR, ELC, ELP, ELS

! Summation for carbohydrate residues alone
CALL SUM_PROPERTIES( 21, 27, IAC, WEIGHT, BDTOT, BHTOT, ELTOT, VOLC, VOLP, VOLZ, VOLZZ, VOLCC, VOLR, VOLS, ISUMC)

IF (WEIGHT .NE. 0.0) THEN
    FRWT=(WEIGHT*100.0)/TOTWT

    ! Calculate densities and specific volumes 

    BHM = BHTOT/WEIGHT
    BDM = BDTOT/WEIGHT
      
    SVC = VOLC * AVAGADRO/WEIGHT
    SVP = VOLP * AVAGADRO/WEIGHT
    SVZ = VOLZ * AVAGADRO/WEIGHT
    SVZZ = VOLZZ * AVAGADRO/WEIGHT
    SVCC = VOLCC * AVAGADRO/WEIGHT
    SVR= VOLR * AVAGADRO/WEIGHT
    SVS= VOLS * AVAGADRO/WEIGHT
      
    ELC = ELTOT/VOLC
    ELZ = ELTOT/VOLZ
    ELP = ELTOT/VOLP
    ELCC = ELTOT/VOLCC
    ELZZ = ELTOT/VOLZZ
    ELR = ELTOT/VOLR
    ELS = ELTOT/VOLS
      
    SDHC = BHTOT/VOLC
    SDDC = BDTOT/VOLC
    SDHP = BHTOT/VOLP
    SDDP = BDTOT/VOLP
    SDHZ = BHTOT/VOLZ
    SDDZ = BDTOT/VOLZ
    SDHZZ = BHTOT/VOLZZ
    SDDZZ = BDTOT/VOLZZ
    SDHCC = BHTOT/VOLCC
    SDDCC = BDTOT/VOLCC
    SDHR = BHTOT/VOLR
    SDDR = BDTOT/VOLR
    SDHS = BHTOT/VOLS
    SDDS = BDTOT/VOLS

    ! Calculate Matchpoints
      
    ATPTC = ((SDHC-BHHO)*100.0)/(BDDO-BHHO-SDDC+SDHC)
    ATPTP = ((SDHP-BHHO)*100.0)/(BDDO-BHHO-SDDP+SDHP)
    ATPTZ = ((SDHZ-BHHO)*100.0)/(BDDO-BHHO-SDDZ+SDHZ)
    ATPTZZ= ((SDHZZ-BHHO)*100.0)/(BDDO-BHHO-SDDZZ+SDHZZ)
    ATPTCC= ((SDHCC-BHHO)*100.0)/(BDDO-BHHO-SDDCC+SDHCC)
    ATPTR = ((SDHR-BHHO)*100.0)/(BDDO-BHHO-SDDR+SDHR)
    ATPTS = ((SDHS-BHHO)*100.0)/(BDDO-BHHO-SDDS+SDHS)
    SCC = (ATPTC*(BDDO-BHHO)/100.0) + BHHO
    SCP = (ATPTP*(BDDO-BHHO)/100.0) + BHHO
    SCZ = (ATPTZ*(BDDO-BHHO)/100.0) + BHHO
    SCZZ= (ATPTZZ*(BDDO-BHHO)/100.0) + BHHO
    SCCC= (ATPTCC*(BDDO-BHHO)/100.0) + BHHO
    SCR = (ATPTR*(BDDO-BHHO)/100.0) + BHHO
    SCS = (ATPTS*(BDDO-BHHO)/100.0) + BHHO

    WRITE(6,*) " ************* CARBOHYDRATE RESIDUES *****************************************"
    WRITE (6,'(A,F10.0,A,F5.1,A,I5)') " MOLECULAR WEIGHT           ", WEIGHT, "       % MASS ", FRWT,"       RESIDUES ", ISUMC

    WRITE (6,'(A,F10.2,4X,F10.2)') " TOTAL B      IN H2O & D2O  ", BHTOT, BDTOT
    WRITE (6,'(A,F10.7,4X,F10.7)') " TOTAL B ON M IN H2O & D2O  ", BHM,BDM
    WRITE (6,'(A,F10.7,A,F10.7,A)') " SCATT DENSITIES OF WATER   ", BHHO, " H2O", BDDO, " D2O "
    WRITE (6,'(A,F10.0)') " TOTAL ELECTRONS            ", ELTOT
    WRITE (6,'(A,F10.5)') " ELECT DENSITY  OF WATER    ", EHHO
    WRITE (6,'(17X,A)') "   C&E 43  ZAM 72  ZAM 84  RIC 74  CHO 75  PER 85  CON 85"
    WRITE (6,'(A,7F8.0)') " VOLUME           ", VOLCC, VOLZ, VOLZZ, VOLR, VOLC, VOLP, VOLS
    WRITE (6,'(A,7F8.4)') " SPECIFIC VOLUMES ", SVCC, SVZ, SVZZ, SVR, SVC, SVP, SVS
    WRITE (6,'(A,7F8.2)') " MATCHPOINTS      ", ATPTCC, ATPTZ, ATPTZZ, ATPTR, ATPTC, ATPTP, ATPTS
    WRITE (6,'(A,7F8.5)') " SCATT DEN AT MTPT", SCCC, SCZ, SCZZ, SCR, SCC, SCP, SCS
    WRITE (6,'(A,7F8.5)') " ELECT DEN        ", ELCC, ELZ, ELZZ, ELR, ELC, ELP, ELS

END IF
      
! Exchange for peptide hydrogens     

WRITE(6,'(A)')" ************* EXCHANGEABLE PEPTIDE HYDROGENS ********************************" 
WRITE(6,'(25X,A)') "   C&E43  ZAM72  ZAM84  RIC74  CHO75  PER85  CON85"

CALL SUM_PROPERTIES( 1, 27, IAC, WEIGHT, BDTOT, BHTOT, ELTOT, VOLC, VOLP, VOLZ, VOLZZ, VOLCC, VOLR, VOLS, ISUMC)

SDHC = BHTOT/VOLC
SDHP = BHTOT/VOLP
SDHZ = BHTOT/VOLZ
SDHZZ= BHTOT/VOLZZ
SDHCC= BHTOT/VOLCC
SDHR = BHTOT/VOLR
SDHS = BHTOT/VOLS

DO II=1,10
    BDTOT = 0.0
    FM=II*0.1
    DO I=1,27
        ! 1.0413 is the difference between H and D scattering lengths
        BDTOT = BDTOT + BD(I)*IAC(I) - (NOPEEX(I) * 1.0413 * FM * IAC(I))
    END DO

    SDDC = BDTOT/VOLC
    SDDP = BDTOT/VOLP
    SDDZ = BDTOT/VOLZ
    SDDZZ= BDTOT/VOLZZ
    SDDCC= BDTOT/VOLCC
    SDDR = BDTOT/VOLR
    SDDS = BDTOT/VOLS
      
    ATPTC = ((SDHC-BHHO)*100.0)/(BDDO-BHHO-SDDC+SDHC)
    ATPTP = ((SDHP-BHHO)*100.0)/(BDDO-BHHO-SDDP+SDHP)
    ATPTZ = ((SDHZ-BHHO)*100.0)/(BDDO-BHHO-SDDZ+SDHZ)
    ATPTZZ= ((SDHZZ-BHHO)*100.0)/(BDDO-BHHO-SDDZZ+SDHZZ)
    ATPTCC= ((SDHCC-BHHO)*100.0)/(BDDO-BHHO-SDDCC+SDHCC)
    ATPTR = ((SDHR -BHHO)*100.0)/(BDDO-BHHO-SDDR+SDHR)
    ATPTS = ((SDHS -BHHO)*100.0)/(BDDO-BHHO-SDDS+SDHS)
      
    WRITE (6,'(A,F4.1,A,2F6.0,7F7.2)') " EXC", FM, " TOT B", BHTOT, BDTOT, ATPTCC, ATPTZ, ATPTZZ, ATPTR, ATPTC, ATPTP, ATPTS
      
END DO

! Exchange for all hydrogens  

WRITE (6,'(A)') " ************* TOTAL OF EXCHANGEABLE HYDROGENS *******************************"
WRITE(6,'(25X,A)') "   C&E43  ZAM72  ZAM84  RIC74  CHO75  PER85  CON85"


DO II= 1,10
    BDTOT = 0.0
    FM=II*0.1
    DO I=1,27
        ! 1.0413 is the difference between H and D scattering lengths 
        BDTOT = BDTOT + BD(I)*IAC(I) - (NOEX(I) * 1.0413 * FM * IAC(I))
    END DO

    SDDC = BDTOT/VOLC
    SDDP = BDTOT/VOLP
    SDDZ = BDTOT/VOLZ
    SDDZZ= BDTOT/VOLZZ
    SDDCC= BDTOT/VOLCC
    SDDR = BDTOT/VOLR
    SDDS = BDTOT/VOLS
      
    ATPTC = ((SDHC-BHHO)*100.0)/(BDDO-BHHO-SDDC+SDHC)
    ATPTP = ((SDHP-BHHO)*100.0)/(BDDO-BHHO-SDDP+SDHP)
    ATPTZ = ((SDHZ-BHHO)*100.0)/(BDDO-BHHO-SDDZ+SDHZ)
    ATPTZZ= ((SDHZZ-BHHO)*100.0)/(BDDO-BHHO-SDDZZ+SDHZZ)
    ATPTCC= ((SDHCC-BHHO)*100.0)/(BDDO-BHHO-SDDCC+SDHCC)
    ATPTR = ((SDHR -BHHO)*100.0)/(BDDO-BHHO-SDDR+SDHR)
    ATPTS = ((SDHS -BHHO)*100.0)/(BDDO-BHHO-SDDS+SDHS)
      
    WRITE (6,'(A,F4.1,A,2F6.0,7F7.2)') " EXC", FM, " TOT B", BHTOT, BDTOT, ATPTCC, ATPTZ, ATPTZZ, ATPTR, ATPTC, ATPTP, ATPTS
    
END DO

WRITE(6,'(1X)')
WRITE(6,'(1X)')
      
CONTAINS

SUBROUTINE SUM_PROPERTIES( FIRST, LAST, IAC, WEIGHT, BDTOT, BHTOT, ELTOT, VOLC, VOLP, VOLZ, VOLZZ, VOLCC, VOLR, VOLS, ISUMC)

! Sum the various properties for the residues between the FIRST and LAST indicies
! See the definition of AN in the main program for the ordering
! IAC provides the number of each residue type 

    INTEGER, INTENT(IN) :: FIRST, LAST
    INTEGER, DIMENSION(27), INTENT(IN) :: IAC
    REAL, INTENT(OUT) :: WEIGHT, BDTOT, BHTOT, ELTOT, VOLC, VOLP, VOLZ, VOLZZ, VOLCC, VOLR, VOLS
    INTEGER, INTENT(OUT) :: ISUMC

    INTEGER :: I
    REAL, DIMENSION(27) :: AVS, AVR, AVZ84, AVCE, ELEC, AVC, AVZ72, AVP, BH, BD, WT
    COMMON AVS, AVR, AVZ84, AVCE, ELEC, AVC, AVZ72, AVP, BH, BD, WT

    WEIGHT=0.0
    BDTOT=0.0
    BHTOT=0.0
    ELTOT=0.0
    VOLC=0.0
    VOLP=0.0
    VOLZ=0.0
    VOLZZ=0.0
    VOLCC=0.0
    VOLR=0.0
    VOLS=0.0
    ISUMC = 0

    DO I = FIRST, LAST 
        ISUMC = ISUMC + IAC(I)
        BHTOT = BHTOT + BH(I) * IAC(I)
        BDTOT = BDTOT + BD(I)*IAC(I)
        ELTOT = ELTOT + ELEC(I)*IAC(I)
        WEIGHT = WEIGHT + (IAC(I)*WT(I))
        VOLC = VOLC + IAC(I)*AVC(I)
        VOLP = VOLP + IAC(I)*AVP(I)
        VOLZ = VOLZ + IAC(I)*AVZ72(I)
        VOLZZ = VOLZZ + IAC(I)*AVZ84(I)
        VOLCC = VOLCC + IAC(I)*AVCE(I)
        VOLR = VOLR + IAC(I)*AVR(I)
        VOLS = VOLS + IAC(I)*AVS(I)
    END DO

RETURN

END SUBROUTINE SUM_PROPERTIES

END PROGRAM
